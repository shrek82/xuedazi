# è¾“å…¥é€Ÿåº¦ç»Ÿè®¡åŠŸèƒ½

## 1. åŠŸèƒ½æ¦‚è¿°

**è¾“å…¥é€Ÿåº¦ç»Ÿè®¡**åŠŸèƒ½ç”¨äºå®æ—¶æ˜¾ç¤ºç”¨æˆ·åœ¨å½“å‰è½®æ¸¸æˆä¸­çš„æ‹¼éŸ³è¾“å…¥é€Ÿåº¦ï¼Œå¸®åŠ©ç”¨æˆ·äº†è§£è‡ªå·±çš„æ‰“å­—é€Ÿåº¦å¹¶æ¿€åŠ±æå‡ã€‚

**ä½ç½®**ï¼šæ¸¸æˆç•Œé¢å·¦ä¾§è¿›åº¦æ¡åŒºåŸŸæœ€ä¸‹æ–¹ï¼ˆæ—¶é—´è¿›åº¦æ¡ä¸‹æ–¹ï¼‰

---

## 2. éœ€æ±‚è§„æ ¼

### 2.1 æ ¸å¿ƒéœ€æ±‚

1. **å®æ—¶ç»Ÿè®¡**ï¼šåœ¨æ¸¸æˆè¿›è¡Œè¿‡ç¨‹ä¸­ï¼Œå®æ—¶è®¡ç®—å¹¶æ˜¾ç¤ºç”¨æˆ·çš„è¾“å…¥é€Ÿåº¦
2. **ç²¾å‡†è®¡ç®—**ï¼šç»Ÿè®¡ä»æ¸¸æˆå¼€å§‹åˆ°å½“å‰çš„è¾“å…¥é€Ÿåº¦ï¼Œåæ˜ ç”¨æˆ·çœŸå®æ°´å¹³
3. **è§†è§‰åé¦ˆ**ï¼šä½¿ç”¨è¿›åº¦æ¡å½¢å¼å±•ç¤ºï¼Œä¸å…¶ä»–è¿›åº¦æ¡é£æ ¼ä¿æŒä¸€è‡´
4. **åŠ¨æ€æ•ˆæœ**ï¼šæ ¹æ®é€Ÿåº¦å˜åŒ–æ˜¾ç¤ºä¸åŒé¢œè‰²å’Œå›¾æ ‡ï¼Œæ¿€åŠ±ç”¨æˆ·æå‡é€Ÿåº¦

### 2.2 ç»Ÿè®¡å¯¹è±¡

- **ç»Ÿè®¡å†…å®¹**ï¼šæ­£ç¡®è¾“å…¥çš„æ‹¼éŸ³å­—æ¯æ•°ï¼ˆä¸æ˜¯æ±‰å­—æ•°ï¼‰
- **ç¤ºä¾‹**ï¼šè¾“å…¥"ä½ å¥½"ï¼ˆnihaoï¼‰= 5 ä¸ªå­—æ¯
- **åŸå› **ï¼šæ‹¼éŸ³æ‰“å­—æœ¬è´¨æ˜¯è¾“å…¥å­—æ¯ï¼Œç»Ÿè®¡å­—æ¯æ•°æ›´ç¬¦åˆæ‰“å­—é€Ÿåº¦çš„å®é™…è¡¡é‡æ ‡å‡†

### 2.3 æ—¶é—´è®¡ç®—

- **è®¡ç®—æ–¹å¼**ï¼šä»æ¸¸æˆå¼€å§‹åˆ°å½“å‰çš„æ€»æ—¶é—´
- **æœ€å°æœ‰æ•ˆæ—¶é—´**ï¼š0.5 ç§’ï¼ˆé¿å…åˆå§‹é€Ÿåº¦è¿‡å¤§ï¼‰
- **è¯´æ˜**ï¼šä¸æ’é™¤ TTS æš‚åœæ—¶é—´ï¼Œå› ä¸º TTS æ—¶é—´ç›¸å¯¹è¾ƒçŸ­ï¼Œå¯¹æ•´ä½“é€Ÿåº¦å½±å“ä¸å¤§

---

## 3. æŠ€æœ¯å®ç°

### 3.1 æ•°æ®æ¨¡å‹ (`ScoreManager.swift`)

```swift
// MARK: - Typing Speed Statistics
/// å½“å‰è½®æ¸¸æˆçš„è¾“å…¥é€Ÿåº¦ç»Ÿè®¡ï¼ˆå­—/åˆ†é’Ÿï¼‰
@Published var typingSpeedWPM: Double = 0.0

/// å½“å‰è½®ç´¯è®¡æ­£ç¡®è¾“å…¥çš„å­—æ¯æ•°ï¼ˆç”¨äºé€Ÿåº¦ç»Ÿè®¡ï¼‰
private var sessionCorrectLetters: Int = 0

/// å½“å‰è½®æ¸¸æˆå¼€å§‹æ—¶é—´
private var sessionStartTime: Date?

/// æ˜¯å¦åœ¨ TTS æœ—è¯»æˆ–è·³è½¬ç­‰å¾…ä¸­ï¼ˆç”¨äº UI æ˜¾ç¤ºï¼‰
@Published var isPausedForTTS: Bool = false
```

### 3.2 æ ¸å¿ƒæ–¹æ³•

#### 3.2.1 å¼€å§‹æ–°ä¸€è½®æ¸¸æˆ

```swift
func startNewSession() {
    sessionStartTime = Date()
    sessionCorrectLetters = 0
    typingSpeedWPM = 0.0
    isPausedForTTS = false
}
```

#### 3.2.2 è®°å½•æ­£ç¡®è¾“å…¥

```swift
func recordCorrectLetter() {
    sessionCorrectLetters += 1
    updateTypingSpeed()
}
```

#### 3.2.3 æ›´æ–°é€Ÿåº¦

```swift
func updateTypingSpeed() {
    guard let startTime = sessionStartTime else {
        typingSpeedWPM = 0.0
        return
    }
    
    // è®¡ç®—ä»æ¸¸æˆå¼€å§‹åˆ°ç°åœ¨çš„æ€»æ—¶é—´
    let totalTime = Date().timeIntervalSince(startTime)
    
    // é™åˆ¶æœ€å°æœ‰æ•ˆæ—¶é—´ä¸º 0.5 ç§’ï¼Œé¿å…åˆå§‹é€Ÿåº¦è¿‡å¤§
    guard totalTime >= 0.5 else {
        typingSpeedWPM = 0.0
        return
    }
    
    // è®¡ç®—é€Ÿåº¦ï¼šå­—æ¯æ•° / æ—¶é—´ (åˆ†é’Ÿ)
    let timeInMinutes = totalTime / 60.0
    if timeInMinutes > 0 {
        typingSpeedWPM = Double(sessionCorrectLetters) / timeInMinutes
    } else {
        typingSpeedWPM = 0.0
    }
}
```

### 3.3 è°ƒç”¨æ—¶æœº

åœ¨ `StandardModeStrategy.handleCorrectInput()` ä¸­è°ƒç”¨ï¼š

```swift
private func handleCorrectInput(char: Character, index: Int) {
    // ... å…¶ä»–é€»è¾‘
    
    // è®°å½•æ­£ç¡®è¾“å…¥çš„å­—æ¯ï¼ˆç”¨äºé€Ÿåº¦ç»Ÿè®¡ï¼‰
    scoreManager.recordCorrectLetter()
}
```

---

## 4. UI å®ç°

### 4.1 ç»„ä»¶ç»“æ„ (`TypingSpeedView.swift`)

```swift
struct TypingSpeedProgressBar: View {
    let typingSpeedWPM: Double
    let isPausedForTTS: Bool
    
    var body: some View {
        HStack(spacing: 12) {
            // å›¾æ ‡
            Image(systemName: speedIcon)
                .foregroundColor(speedColor)
            
            VStack(alignment: .leading, spacing: 6) {
                // é€Ÿåº¦å€¼
                Text(speedLabel)
                    .foregroundColor(speedColor)
                
                // TTS çŠ¶æ€æŒ‡ç¤º
                if isPausedForTTS {
                    Image(systemName: "speaker.wave.2")
                }
                
                // è¿›åº¦æ¡
                GeometryReader { proxy in
                    Capsule()
                        .fill(LinearGradient(colors: [speedColor, speedColor.opacity(0.7)], 
                                            startPoint: .leading, 
                                            endPoint: .trailing))
                        .frame(width: progressWidth * proxy.size.width)
                }
                
                // å‰¯æ ‡é¢˜
                Text("è¾“å…¥é€Ÿåº¦")
            }
        }
    }
}
```

### 4.2 é€Ÿåº¦ç­‰çº§ä¸è§†è§‰åé¦ˆ

| é€Ÿåº¦èŒƒå›´ | å›¾æ ‡ | é¢œè‰² | è¿›åº¦æ¡å¡«å…… | è¯´æ˜ |
|----------|------|------|------------|------|
| < 30 å­—/åˆ† | ğŸ¢ `tortoise.fill` | `.orange` | ~17% | æ…¢é€Ÿ |
| 30-60 å­—/åˆ† | ğŸ‡ `hare.fill` | `.themeSkyBlue` | ~20-40% | ä¸­é€Ÿ |
| 60-100 å­—/åˆ† | âš¡ `bolt.fill` | `.themeAmberYellow` | ~40-67% | å¿«é€Ÿ |
| > 100 å­—/åˆ† | ğŸ”¥ `flame.fill` | `.themeSuccessGreen` | ~67-100% | æé€Ÿ |

### 4.3 è¿›åº¦æ¡è®¡ç®—

```swift
/// è¿›åº¦æ¡å®½åº¦æ¯”ä¾‹ï¼ˆ0-1ï¼‰
/// å‡è®¾æœ€é«˜é€Ÿåº¦ä¸º 150 å­—/åˆ†ï¼Œè¶…è¿‡åˆ™ä¿æŒæ»¡è¿›åº¦
private var progressWidth: CGFloat {
    let maxSpeed: Double = 150.0
    return min(CGFloat(typingSpeedWPM / maxSpeed), 1.0)
}
```

---

## 5. è®¡ç®—å…¬å¼

### 5.1 é€Ÿåº¦è®¡ç®—

```
è¾“å…¥é€Ÿåº¦ (å­—/åˆ†é’Ÿ) = æ­£ç¡®è¾“å…¥å­—æ¯æ•° / æœ‰æ•ˆæ—¶é—´ (åˆ†é’Ÿ)

å…¶ä¸­ï¼š
- æ­£ç¡®è¾“å…¥å­—æ¯æ•°ï¼šsessionCorrectLetters
- æœ‰æ•ˆæ—¶é—´ = max(æ€»æ—¶é—´ï¼Œ0.5 ç§’)
- æ€»æ—¶é—´ = Date().timeIntervalSince(sessionStartTime)
```

### 5.2 ç¤ºä¾‹è®¡ç®—

**åœºæ™¯**ï¼šç”¨æˆ·åœ¨ 30 ç§’å†…æ­£ç¡®è¾“å…¥äº† 50 ä¸ªå­—æ¯

```
æ€»æ—¶é—´ = 30 ç§’ = 0.5 åˆ†é’Ÿ
é€Ÿåº¦ = 50 / 0.5 = 100 å­—/åˆ†é’Ÿ
è¿›åº¦æ¡å¡«å…… = 100 / 150 = 67%
é¢œè‰²ï¼šç¥ç€é»„ (.themeAmberYellow)
å›¾æ ‡ï¼šé—ªç”µ (bolt.fill)
```

---

## 6. å¸ƒå±€ä½ç½®

```
å·¦ä¾§è¿›åº¦æ¡åŒºåŸŸï¼ˆä»ä¸Šåˆ°ä¸‹ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“š é¢˜ç›®è¿›åº¦ 1/20        â”‚
â”‚ ğŸ° â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 50%       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”¥ è¿å‡»è¿›åº¦             â”‚
â”‚    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 50%       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸš© é˜¶æ®µå¥–åŠ±è¿›åº¦         â”‚
â”‚    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 50%       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ• æ—¶é—´è¿›åº¦ï¼ˆé™æ—¶æ¨¡å¼ï¼‰ â”‚
â”‚    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 50%       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âš¡ è¾“å…¥é€Ÿåº¦ 85 å­—/åˆ†      â”‚  â† æ–°å¢
â”‚    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 57%   â”‚
â”‚    è¾“å…¥é€Ÿåº¦             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. é£æ ¼è®¾è®¡

### 7.1 ä¸å…¶ä»–è¿›åº¦æ¡ä¸€è‡´çš„å…ƒç´ 

1. **å®¹å™¨æ ·å¼**ï¼š
   - èƒŒæ™¯ï¼š`Color.black.opacity(0.2)`
   - åœ†è§’ï¼š`cornerRadius(12)`
   - å†…è¾¹è·ï¼š`padding(12)`

2. **å›¾æ ‡**ï¼š
   - å°ºå¯¸ï¼š`20x20`
   - å­—é‡ï¼š`.bold`
   - é¢œè‰²ï¼šæ ¹æ®é€Ÿåº¦åŠ¨æ€å˜åŒ–

3. **è¿›åº¦æ¡**ï¼š
   - è½¨é“ï¼š`Color.black.opacity(0.3)` + èƒ¶å›Šå½¢
   - å¡«å……ï¼šå½©è‰²æ¸å˜ + èƒ¶å›Šå½¢
   - é«˜åº¦ï¼š`8`
   - åŠ¨ç”»ï¼šå¼¹ç°§åŠ¨ç”» `.spring(response: 0.4, dampingFraction: 0.7)`

4. **æ–‡å­—**ï¼š
   - é€Ÿåº¦å€¼ï¼š`.system(size: 16, weight: .heavy, design: .rounded)`
   - å‰¯æ ‡é¢˜ï¼š`.system(size: 13, weight: .medium)` + `.white.opacity(0.8)`

---

## 8. æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | èŒè´£ |
|------|------|
| `ScoreManager.swift` | é€Ÿåº¦ç»Ÿè®¡æ ¸å¿ƒé€»è¾‘ |
| `GameStrategy.swift` | è°ƒç”¨é€Ÿåº¦ç»Ÿè®¡æ–¹æ³• |
| `GameViewModel.swift` | çŠ¶æ€è½¬å‘åˆ°è§†å›¾ |
| `GameView.swift` | åœ¨ UI ä¸­æ˜¾ç¤ºé€Ÿåº¦ç»Ÿè®¡ |
| `TypingSpeedView.swift` | é€Ÿåº¦ç»Ÿè®¡è§†å›¾ç»„ä»¶ |
| `docs/TYPING_SPEED_STATS.md` | åŠŸèƒ½æ–‡æ¡£ï¼ˆæœ¬æ–‡æ¡£ï¼‰ |

---

## 9. æœªæ¥ä¼˜åŒ–æ–¹å‘

1. **æ’é™¤ TTS æ—¶é—´**ï¼šå¦‚æœéœ€è¦æ›´ç²¾ç¡®çš„ç»Ÿè®¡ï¼Œå¯ä»¥é‡æ–°å¼•å…¥ TTS æš‚åœæ—¶é—´æ’é™¤é€»è¾‘
2. **æ±‰å­—æ•°ç»Ÿè®¡**ï¼šå¯é€‰ç»Ÿè®¡æ­£ç¡®è¾“å…¥çš„æ±‰å­—æ•°ï¼ˆè€Œä¸æ˜¯å­—æ¯æ•°ï¼‰
3. **å†å²è®°å½•**ï¼šè®°å½•æ¯è½®æ¸¸æˆçš„æœ€é«˜é€Ÿåº¦ï¼Œæ”¯æŒå¯¹æ¯”
4. **æˆå°±ç³»ç»Ÿ**ï¼šæ ¹æ®é€Ÿåº¦è¾¾æˆè§£é”æˆå°±

---

## 10. ç›¸å…³æ–‡æ¡£

- [GAME_RULES.md](GAME_RULES.md) - æ¸¸æˆè§„åˆ™ä¸éœ€æ±‚è®¾è®¡
- [INPUT_TTS_NARRATOR.md](INPUT_TTS_NARRATOR.md) - è¾“å…¥é€»è¾‘ã€æœ—è¯µæœºåˆ¶ä¸æ—ç™½ç³»ç»Ÿ
- [ARCHITECTURE.md](../ARCHITECTURE.md) - ç³»ç»Ÿæ¶æ„æ–‡æ¡£

---

*æ–‡æ¡£ç‰ˆæœ¬ï¼š1.0*  
*åˆ›å»ºæ—¥æœŸï¼š2026 å¹´ 3 æœˆ 1 æ—¥*  
*ä½œè€…ï¼šxuedazi å›¢é˜Ÿ*