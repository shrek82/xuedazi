//
//  NarratorManager.swift
//  xuedazi
//
//  Created by up on 2026/2/21.
//

import Foundation
import Combine

enum NarratorEvent {
    case gameStart
    case combo(Int)
    case milestone
    case error
    case lowHealth
    case gameOver
    case victory
}

enum NarratorType: String, CaseIterable, Codable {
    case spongeBob = "æµ·ç»µå®å®"
    case tsundereCat = "å‚²å¨‡çŒ«"
    case toxicRabbit = "æ¯’èˆŒå…”"
    case kindGrandpa = "è€çˆ·çˆ·"
    case robot = "æœºå™¨äºº"
    case charmingSister = "å¦©åªšå§å§"
    case coolGod = "é«˜å†·ç”·ç¥"
    case funnyAunt = "æ»‘ç¨½å¤§å¦ˆ"
    case klee = "å°‘å¥³å¯è‰"
    case animeGirl = "åŠ¨æ¼«å°‘å¥³"
}

struct NarratorPersona {
    let voice: XunFeiTTSManager.VoiceType
    let phrases: [String: [String]]
}

class NarratorManager: ObservableObject {
    static let shared = NarratorManager()
    
    private let tts: XunFeiTTSManager
    private var lastSpeakTime: Date = Date.distantPast
    
    @Published var currentType: NarratorType = .spongeBob {
        didSet {
            updateVoice()
            saveSettings()
        }
    }
    
    @Published var isEnabled: Bool = true {
        didSet { saveSettings() }
    }
    
    @Published var speed: Int = 60 {
        didSet { 
            tts.speed = speed
            saveSettings() 
        }
    }
    
    @Published var volume: Int = 70 {
        didSet { 
            tts.volume = volume
            saveSettings() 
        }
    }
    
    @Published var pitch: Int = 50 {
        didSet { 
            tts.pitch = pitch
            saveSettings() 
        }
    }
    
    @Published var minInterval: TimeInterval = 4.0 {
        didSet { saveSettings() }
    }
    
    private var personas: [NarratorType: NarratorPersona] = [:]
    
    private init() {
        // Create independent TTS instance, do not persist settings to avoid affecting global TTS
        self.tts = XunFeiTTSManager(persistSettings: false)
        
        setupPersonas()
        loadSettings()
        updateVoice()
    }
    
    private func loadSettings() {
        let defaults = UserDefaults.standard
        if let savedType = defaults.string(forKey: "narratorType"),
           let type = NarratorType(rawValue: savedType) {
            self.currentType = type
        }
        
        if defaults.object(forKey: "narratorEnabled") != nil {
            self.isEnabled = defaults.bool(forKey: "narratorEnabled")
        }
        
        self.speed = defaults.integer(forKey: "narratorSpeed")
        if self.speed == 0 { self.speed = 60 }
        
        self.volume = defaults.integer(forKey: "narratorVolume")
        if self.volume == 0 { self.volume = 70 }
        
        self.pitch = defaults.integer(forKey: "narratorPitch")
        if self.pitch == 0 { self.pitch = 50 }
        
        self.minInterval = defaults.double(forKey: "narratorInterval")
        if self.minInterval == 0 { self.minInterval = 4.0 }
        
        // Apply loaded settings to TTS
        self.tts.speed = self.speed
        self.tts.volume = self.volume
        self.tts.pitch = self.pitch
    }
    
    private func saveSettings() {
        let defaults = UserDefaults.standard
        defaults.set(currentType.rawValue, forKey: "narratorType")
        defaults.set(isEnabled, forKey: "narratorEnabled")
        defaults.set(speed, forKey: "narratorSpeed")
        defaults.set(volume, forKey: "narratorVolume")
        defaults.set(pitch, forKey: "narratorPitch")
        defaults.set(minInterval, forKey: "narratorInterval")
    }
    
    private func setupPersonas() {
        // 1. æµ·ç»µå®å® (SpongeBob)
        personas[.spongeBob] = NarratorPersona(
            voice: .huanlemianbao,
            phrases: [
                "start": [
                    "å‡†å¤‡å¥½äº†å—ï¼Ÿæ‹¼éŸ³å¤§å†’é™©å¼€å§‹å•¦ï¼",
                    "å˜¿å˜¿ï¼Œæˆ‘æ˜¯ä½ çš„æµ·ç»µå®å®è§£è¯´å‘˜ï¼",
                    "è®©æˆ‘ä»¬çœ‹çœ‹ä½ çš„æ‰‹æŒ‡æœ‰å¤šçµæ´»ï¼"
                ],
                "combo_5": [
                    "å“‡å“¦ï¼Œäº”è¿å‡»ï¼",
                    "ä¸é”™å“¦ï¼Œç»§ç»­ä¿æŒï¼",
                    "æœ‰ç‚¹æ„æ€äº†ï¼"
                ],
                "combo_10": [
                    "åè¿å‡»ï¼ä½ ç®€ç›´æ˜¯å¤©æ‰ï¼",
                    "å¤ªå¼ºäº†ï¼Œæˆ‘éƒ½çœ‹å‘†äº†ï¼",
                    "è¿™å°±æ˜¯ä¼ è¯´ä¸­çš„æ— å½±æ‰‹å—ï¼Ÿ"
                ],
                "combo_20": [
                    "äºŒåè¿å‡»ï¼ç¥ä¸€èˆ¬çš„æ“ä½œï¼",
                    "å·²ç»æ²¡æœ‰äººèƒ½é˜»æ­¢ä½ äº†ï¼",
                    "æµ·ç»µå®å®ä¸ºä½ ç–¯ç‹‚æ‰“callï¼"
                ],
                "combo_30": [
                    "ä¸‰åè¿å‡»ï¼ä½ æ˜¯ä¸æ˜¯å·å·ç»ƒè¿‡ï¼",
                    "å¤ªç–¯ç‹‚äº†ï¼Œæˆ‘éƒ½è·Ÿä¸ä¸Šäº†ï¼",
                    "è¿™æ‰‹é€Ÿï¼Œæ˜¯åœ¨åˆ‡èŸ¹é»„å ¡å—ï¼Ÿ"
                ],
                "combo_40": [
                    "å››åè¿å‡»ï¼æˆ‘çš„é“²å­éƒ½æƒŠæ‰äº†ï¼",
                    "å¤©å“ªï¼Œä½ æ˜¯ä¸æ˜¯ç« é±¼å“¥å‡æ‰®çš„ï¼Ÿ",
                    "å¿«åœä¸‹ï¼Œé”®ç›˜è¦ç€ç«å•¦ï¼"
                ],
                "combo_50": [
                    "äº”åè¿å‡»ï¼ç®€ç›´æ˜¯èŸ¹å ¡ç‹æœ€å¼ºå‘˜å·¥ï¼",
                    "æˆ‘è¦æŠŠä½ æŒ‚åœ¨è£èª‰å¢™ä¸Šï¼",
                    "æ¯”åŸºå°¼æµ·æ»©çš„å¥‡è¿¹ï¼"
                ],
                "combo_60": [
                    "å…­åè¿å‡»ï¼æ´¾å¤§æ˜Ÿéƒ½çœ‹å‚»äº†ï¼",
                    "ä½ å°±æ˜¯ä¼ è¯´ä¸­çš„æ‹¼éŸ³å¤§ä¾ ï¼",
                    "è¿™æ“ä½œï¼Œç®€ç›´æ¯”æŠ“æ°´æ¯è¿˜éš¾ï¼"
                ],
                "combo_70": [
                    "ä¸ƒåè¿å‡»ï¼ä½ å°±æ˜¯æ¯”åŸºå°¼æµ·æ»©çš„ä¼ è¯´ï¼",
                    "èŸ¹è€æ¿çœ‹äº†éƒ½è¦ç»™ä½ æ¶¨å·¥èµ„ï¼",
                    "ç¥ä¸€èˆ¬çš„å­˜åœ¨ï¼è†œæ‹œå¤§ç¥ï¼"
                ],
                "milestone": [
                    "æ­å–œè¿‡å…³ï¼Œå¥–åŠ±å¤§å¤§æ»´æœ‰ï¼",
                    "é˜¶æ®µæ€§èƒœåˆ©ï¼Œç»™è‡ªå·±é¼“ä¸ªæŒï¼"
                ],
                "error": [
                    "å“å‘€ï¼Œæ‰‹æ»‘äº†å—ï¼Ÿ",
                    "ä¸è¦æ…Œï¼Œæ·±å‘¼å¸ï¼",
                    "è¿™ä¸ªæ‹¼éŸ³æœ‰ç‚¹è°ƒçš®å“¦ï¼",
                    "é”™äº†é”™äº†ï¼Œå†ä»”ç»†çœ‹çœ‹ï¼"
                ],
                "lowHealth": [
                    "è­¦å‘Šè­¦å‘Šï¼Œè¡€é‡å‘Šæ€¥ï¼",
                    "åšæŒä½ï¼Œä¸èƒ½åœ¨è¿™é‡Œå€’ä¸‹ï¼",
                    "å¿«é›†ä¸­æ³¨æ„åŠ›ï¼Œæˆ‘ä»¬è¦è¾“å•¦ï¼"
                ],
                "gameOver": [
                    "æ¸¸æˆç»“æŸï¼Œä¸‹æ¬¡å†æ¥å†å‰å§ï¼",
                    "è™½ç„¶è¾“äº†ï¼Œä½†å§¿åŠ¿è¿˜æ˜¯å¾ˆå¸…çš„ï¼",
                    "ä¼‘æ¯ä¸€ä¸‹ï¼Œå–å£æ°´å†æ¥ï¼"
                ],
                "victory": [
                    "å¤§è·å…¨èƒœï¼ä½ å°±æ˜¯æ‹¼éŸ³ä¹‹ç‹ï¼",
                    "å¤ªæ£’äº†ï¼Œæµ·ç»µå®å®ä¸ºä½ éª„å‚²ï¼"
                ]
            ]
        )
        
        // 2. å‚²å¨‡çŒ« (Tsundere Cat)
        personas[.tsundereCat] = NarratorPersona(
            voice: .dongmanshaonv,
            phrases: [
                "start": ["å“¼ï¼Œè¿˜è¡Œå§...æ‰ä¸æ˜¯åœ¨å¤¸ä½ ", "åˆ«ä»¥ä¸ºå¼€å§‹äº†æˆ‘å°±è¦å¤¸ä½ ï¼", "å¥½å¥½è¡¨ç°ï¼Œåˆ«ä¸¢æœ¬å–µçš„è„¸ï¼"],
                "combo_5": ["å“¼ï¼Œæ‰5ä¸ª...", "å‹‰å‹‰å¼ºå¼ºå§ï¼", "åˆ«å¾—æ„å¤ªæ—©ï¼"],
                "combo_10": ["åˆ‡ï¼Œè¿™æœ‰ä»€ä¹ˆäº†ä¸èµ·...", "æ‰‹æ„Ÿä¸é”™å˜›...", "ç¨å¾®æœ‰ç‚¹çœ‹å¤´äº†ã€‚"],
                "combo_20": ["è¿™...è¿™ä¸å¯èƒ½ï¼", "ä½ æ€ä¹ˆçªç„¶å˜å‰å®³äº†ï¼Ÿ", "å“¼ï¼Œæœ¬å–µç¨å¾®è®¤å¯ä½ ä¸€ä¸‹ã€‚"],
                "combo_30": ["ä¸‰å...å“¼ï¼Œæœ¬å–µæ‰æ²¡æœ‰è§‰å¾—å‰å®³å‘¢ï¼", "åˆ«ä»¥ä¸ºè¿™æ ·æˆ‘å°±å›å¤¸ä½ ï¼", "åˆ‡ï¼Œè¿æ°”å¥½è€Œå·²ï¼"],
                "combo_40": ["å››åä¸ªï¼Ÿä½ æ˜¯æ€ªç‰©å—ï¼Ÿ", "è¿™æ‰‹é€Ÿ...æœ‰ç‚¹æ¶å¿ƒã€‚", "å‹‰å¼ºç»™ä½ é¼“ä¸ªæŒã€‚"],
                "combo_50": ["äº”å...å¥½å§ï¼Œå…è®¸ä½ éª„å‚²ä¸€ç§’é’Ÿã€‚", "è¿™çœŸçš„æ˜¯äººç±»çš„æ‰‹é€Ÿå—ï¼Ÿ", "åˆ«å¤ªåš£å¼ å“¦ï¼"],
                "combo_60": ["å…­å...å–‚ï¼Œä½ æ˜¯ä¸æ˜¯å¼€æŒ‚äº†ï¼Ÿ", "æœ¬å–µæ‰¿è®¤ä½ æœ‰ç‚¹ä¸œè¥¿ã€‚", "å†å¿«æˆ‘ä¹Ÿä¸ä¼šç†ä½ çš„ï¼"],
                "combo_70": ["ä¸ƒå...ç¬¨è›‹ï¼Œæ‰‹ä¸é…¸å—ï¼Ÿç»™æœ¬å–µåœä¸‹ï¼", "ä½ èµ¢äº†ï¼Œæœ¬å–µæœäº†è¿˜ä¸è¡Œå—ï¼Ÿ", "è¿™å°±æ˜¯æ‰€è°“çš„å¼ºè€…å—...å“¼ï¼"],
                "milestone": ["ä¸æ„§æ˜¯ä½ ï¼...å•Šä¸å¯¹ï¼Œæˆ‘æ˜¯è¯´åˆšå¥½è¿æ°”å¥½ï¼", "è¿‡å…³äº†ï¼Ÿåˆ«å¤ªéª„å‚²å“¦ï¼"],
                "error": ["ç¬¨è›‹ï¼è¿™éƒ½èƒ½é”™ï¼Ÿ", "ä½ æ˜¯çŒªå—ï¼Ÿ", "çœ‹ç€ç‚¹å•Šï¼Œç¬¨æ‰‹ç¬¨è„šçš„ï¼", "å“å‘€~æ‰‹æ»‘äº†ï¼Ÿ"],
                "lowHealth": ["å–‚ï¼ä½ è¦æ­»äº†å—ï¼Ÿ", "åˆ«æ­»åœ¨æœ¬å–µé¢å‰ï¼", "å¿«ç‚¹è®¤çœŸèµ·æ¥å•Šï¼"],
                "gameOver": ["æœç„¶æ˜¯ä¸ªç¬¨è›‹...", "å“¼ï¼Œæ—©å°±çŸ¥é“ä½ ä¼šè¾“ã€‚", "ä¸‹æ¬¡å†è¾“å°±ä¸ç†ä½ äº†ï¼"],
                "victory": ["å“¼ï¼Œè¿˜ç®—åä¸½çš„èƒœåˆ©ã€‚", "æœ¬å–µå‹‰å¼ºç»™ä½ æ‰“ä¸ªæ»¡åˆ†ã€‚", "åšå¾—ä¸é”™å˜›...æ‰æ€ªï¼"]
            ]
        )
        
        // 3. æ¯’èˆŒå…” (Toxic Rabbit)
        personas[.toxicRabbit] = NarratorPersona(
            voice: .huoposhaonian,
            phrases: [
                "start": ["å‡†å¤‡å¥½äº†å—ï¼Ÿèœé¸Ÿï¼", "è®©æˆ‘çœ‹çœ‹ä½ èƒ½åšæŒå‡ ç§’ï¼", "é”®ç›˜å‡†å¤‡å¥½äº†å—ï¼Ÿåˆ«æŒ‰åäº†ï¼"],
                "combo_5": ["æ‰5ä¸ªï¼Ÿèœ—ç‰›éƒ½æ¯”ä½ å¿«ï¼", "å°±è¿™ï¼Ÿ", "åˆšçƒ­èº«å—ï¼Ÿ"],
                "combo_10": ["å“Ÿï¼Œæœ‰ç‚¹ä¸œè¥¿å˜›ï¼", "é”®ç›˜å†’çƒŸäº†å—ï¼Ÿ", "è¿™éƒ½èƒ½è’™å¯¹ï¼Ÿ"],
                "combo_20": ["å¼€æŒ‚äº†å§ï¼Ÿ", "æˆ‘ä¸ä¿¡è¿™æ˜¯ä½ æ‰“çš„ï¼", "è¿™æ‰‹é€Ÿï¼Œå•èº«å¤šå°‘å¹´äº†ï¼Ÿ"],
                "combo_30": ["ä¸‰åï¼Ÿè¿æ°”å¥½è€Œå·²ï¼Œåˆ«åš£å¼ ï¼", "å†å¿«ç‚¹ï¼Œæ²¡åƒé¥­å—ï¼Ÿ", "ä¹Ÿå°±ä¸€èˆ¬èˆ¬å§ã€‚"],
                "combo_40": ["å››åï¼Ÿè‚¯å®šæ˜¯é”®ç›˜åäº†è‡ªåŠ¨æ‰“çš„ï¼", "æˆ‘ä¸ä¿¡ï¼ç»å¯¹æ˜¯ä½œå¼Šï¼", "å“¼ï¼ŒççŒ«ç¢°ä¸Šæ­»è€—å­ï¼"],
                "combo_50": ["äº”åï¼Ÿæˆ‘è¦ä¸¾æŠ¥ä½ ï¼", "è¿™ä¸ç§‘å­¦ï¼", "ä½ æ˜¯ä¸æ˜¯æœºå™¨äººï¼Ÿ"],
                "combo_60": ["å…­åï¼Ÿäººç±»ä¸å¯èƒ½è¿™ä¹ˆå¿«ï¼", "æˆ‘ä¸ç©äº†ï¼Œæ²¡æ„æ€ï¼", "ä½ èµ¢äº†è¡Œäº†å§ï¼"],
                "combo_70": ["ä¸ƒåï¼Ÿä½ æ˜¯å˜æ€ï¼", "æˆ‘è¦æŠŠä½ æ‹‰é»‘ï¼", "å†è§ï¼ä¸è·Ÿä½ ç©äº†ï¼"],
                "milestone": ["è¿™éƒ½èƒ½è¿‡ï¼Ÿè¿æ°”çœŸå¥½ï¼", "ä¸‹ä¸€å…³è‚¯å®šæŒ‚ï¼ŒèµŒäº”æ¯›ï¼"],
                "error": ["è¿™éƒ½èƒ½é”™ï¼Œä½ ç¤¼è²Œå—ï¼Ÿ", "çœ¼ç›ä¸è¦å¯ä»¥æç»™æœ‰éœ€è¦çš„äººï¼", "é”®ç›˜çƒ«æ‰‹ï¼Ÿ", "ä»Šå¤©æ²¡åƒé¥­ï¼Ÿ"],
                "lowHealth": ["å¿«æŒ‚äº†å¿«æŒ‚äº†ï¼å¥½è€¶ï¼", "è¦å‡‰å‡‰å’¯~", "å†é”™ä¸€ä¸‹è¯•è¯•ï¼Ÿ"],
                "gameOver": ["æœç„¶å¾ˆèœï¼", "æˆ‘å¥¶å¥¶ç”¨è„šæ‰“éƒ½æ¯”ä½ å¼ºï¼", "å›å®¶å†ç»ƒç»ƒå§ï¼"],
                "victory": ["å±…ç„¶é€šå…³äº†ï¼Ÿä¸ç§‘å­¦ï¼", "ä¸€å®šæ˜¯ç³»ç»Ÿå‡ºBugäº†ï¼", "åˆ‡ï¼Œè¿æ°”å¥½è€Œå·²ï¼"]
            ]
        )
        
        // 4. è€çˆ·çˆ· (Kind Grandpa)
        personas[.kindGrandpa] = NarratorPersona(
            voice: .lingbosong,
            phrases: [
                "start": ["æ…¢æ…¢æ¥ï¼Œä¸ç€æ€¥ï¼Œçˆ·çˆ·ç­‰ä½ ã€‚", "å¥½å­©å­ï¼Œå‡†å¤‡å¼€å§‹å’¯ã€‚", "è®©æˆ‘ä»¬æ¥ç©ä¸ªæœ‰è¶£çš„æ¸¸æˆå§ã€‚"],
                "combo_5": ["å¥½å­©å­ï¼ŒçœŸæ£’ï¼", "ç¨³æ‰ç¨³æ‰“ï¼Œä¸é”™ä¸é”™ã€‚", "æ…¢æ…¢æ¥ï¼Œæ¯”è¾ƒå¿«ã€‚"],
                "combo_10": ["å“å“Ÿï¼ŒçœŸå‰å®³ï¼", "è¿™å­©å­çœŸèªæ˜ï¼", "çˆ·çˆ·ä¸ºä½ éª„å‚²ï¼"],
                "combo_20": ["ç¥ç«¥å•Šï¼", "çœŸæ˜¯åç”Ÿå¯ç•ï¼", "çˆ·çˆ·åƒä½ è¿™ä¹ˆå¤§çš„æ—¶å€™å¯æ²¡è¿™ä¹ˆå‰å®³ã€‚"],
                "combo_30": ["ä¸‰åè¿å‡»ï¼Œå¥½å­©å­ï¼ŒçœŸç¨³å½“ï¼", "åˆ«ç´¯ç€äº†ï¼Œå–å£æ°´ã€‚", "çœŸç»™çˆ·çˆ·é•¿è„¸ï¼"],
                "combo_40": ["å››åå’¯ï¼Œçœ¼ç›ç´¯ä¸ç´¯å‘€ï¼Ÿ", "æ…¢ç‚¹æ‰“ï¼Œåˆ«ä¼¤ç€æ‰‹ã€‚", "çœŸæ£’ï¼ŒçœŸæ£’ï¼"],
                "combo_50": ["äº”åè¿å‡»ï¼çˆ·çˆ·éƒ½è¦è·Ÿä¸ä¸Šä½ äº†ï¼", "ç°åœ¨çš„å­©å­çœŸæ˜¯ä¸å¾—äº†ï¼", "å¥½æ ·çš„ï¼"],
                "combo_60": ["å…­åï¼çœŸæ˜¯å…‰å®—è€€ç¥–å•Šï¼", "çˆ·çˆ·çœ‹å¾—å¿ƒèŠ±æ€’æ”¾ï¼", "è¿™æ‰æ˜¯æˆ‘çš„å¥½å­™å­/å¥³ï¼"],
                "combo_70": ["ä¸ƒåï¼ç°åœ¨çš„å¹´è½»äººå¤ªå‰å®³äº†ï¼", "çˆ·çˆ·æœäº†ï¼", "ä½ æ˜¯å…¨æ‘çš„éª„å‚²ï¼"],
                "milestone": ["åˆè¿‡ä¸€å…³ï¼ŒçœŸäº†ä¸èµ·ï¼", "ä¼‘æ¯ä¸€ä¸‹å—ï¼Ÿåˆ«ç´¯ç€äº†ã€‚", "å¥½æ ·çš„ï¼"],
                "error": ["æ²¡å…³ç³»ï¼Œå†æ¥ä¸€æ¬¡ã€‚", "åˆ«æ€¥åˆ«æ€¥ï¼Œçœ‹æ¸…æ¥šå†æ‰“ã€‚", "å“å“Ÿï¼Œå°å¿ƒä¸€ç‚¹ã€‚", "æ‰‹æ»‘äº†ï¼Ÿæ²¡äº‹çš„ã€‚"],
                "lowHealth": ["å“å‘€ï¼Œè¦å°å¿ƒèº«ä½“å•Šã€‚", "ç¨³ä½ï¼Œè¿˜æœ‰æœºä¼šã€‚", "åˆ«æ…Œï¼Œçˆ·çˆ·ç›¸ä¿¡ä½ ã€‚"],
                "gameOver": ["å°½åŠ›äº†å°±å¥½ã€‚", "ä¼‘æ¯ä¸€ä¸‹ï¼Œå–å£æ°´å†æ¥ã€‚", "å¤±è´¥æ˜¯æˆåŠŸä¹‹æ¯å˜›ã€‚"],
                "victory": ["å¤ªæ£’äº†ï¼ŒçœŸæ˜¯ä¸ªå¤©æ‰ï¼", "çˆ·çˆ·ä¸ºä½ æ„Ÿåˆ°é«˜å…´ï¼", "å®Œç¾ï¼ä¸€å­—ä¸é”™ï¼"]
            ]
        )
        
        // 5. æœºå™¨äºº (Robot)
        personas[.robot] = NarratorPersona(
            voice: .pangbainan,
            phrases: [
                "start": ["ç³»ç»Ÿå¯åŠ¨ï¼ŒåŠ è½½æ‹¼éŸ³æ¨¡å—ã€‚", "æ£€æµ‹åˆ°ç©å®¶è¿›å…¥ï¼Œæ¸¸æˆå¼€å§‹ã€‚", "è¯·äººç±»åšå¥½å‡†å¤‡ã€‚"],
                "combo_5": ["è¿å‡»ç¡®è®¤ï¼š5ã€‚", "çŠ¶æ€è‰¯å¥½ã€‚", "ç»§ç»­ä¿æŒè¾“å‡ºã€‚"],
                "combo_10": ["è¿å‡»ç¡®è®¤ï¼š10ã€‚æ€§èƒ½æå‡ã€‚", "æ£€æµ‹åˆ°é«˜é¢‘æ“ä½œã€‚", "æ“ä½œç²¾å‡†åº¦ï¼šé«˜ã€‚"],
                "combo_20": ["è¿å‡»ç¡®è®¤ï¼š20ã€‚è¶…è¶Šäººç±»æé™ã€‚", "è­¦å‘Šï¼šé”®ç›˜è¿‡çƒ­ã€‚", "æ“ä½œç¥ä¹å…¶æŠ€ã€‚"],
                "combo_30": ["è¿å‡»30ã€‚å¤„ç†å™¨è´Ÿè½½å¢åŠ ã€‚", "è®¡ç®—ä¸­æ¢ï¼šå…´å¥‹ã€‚", "äººç±»æ½œåŠ›ï¼šæƒŠäººã€‚"],
                "combo_40": ["è¿å‡»40ã€‚æ£€æµ‹åˆ°æ‰‹æŒ‡æ®‹å½±ã€‚", "è¾“å…¥é€Ÿåº¦ï¼šæå¿«ã€‚", "ç³»ç»Ÿè¯„ä»·ï¼šä¼˜ç§€ã€‚"],
                "combo_50": ["è¿å‡»50ã€‚è¿›å…¥è¶…ç¥æ¨¡å¼ã€‚", "é€»è¾‘æ ¸å¿ƒï¼šéœ‡æ’¼ã€‚", "è­¦å‘Šï¼šå³å°†çªç ´éŸ³éšœã€‚"],
                "combo_60": ["è¿å‡»60ã€‚ç³»ç»Ÿè¿‡çƒ­è­¦å‘Šã€‚", "å†·å´æ¶²ä¸è¶³ã€‚", "äººç±»ï¼Œä½ å¾ˆå±é™©ã€‚"],
                "combo_70": ["è¿å‡»70ã€‚äººç±»èƒ½åŠ›å·²çªç ´ä¸Šé™ã€‚", "ç³»ç»Ÿå´‡æ‹œç¨‹åºå¯åŠ¨ã€‚", "ä½ æ˜¯ç¥å—ï¼Ÿ"],
                "milestone": ["é˜¶æ®µç›®æ ‡è¾¾æˆã€‚", "å¥–åŠ±å·²å‘æ”¾ã€‚", "è¿›åº¦ä¿å­˜æˆåŠŸã€‚"],
                "error": ["æ£€æµ‹åˆ°é”™è¯¯è¾“å…¥ï¼Œè¯·äººç±»é‡æ–°æ ¡å‡†ã€‚", "é”™è¯¯æŒ‡ä»¤ã€‚", "é€»è¾‘ä¸­æ–­ã€‚", "ä¿®æ­£è¾“å…¥ã€‚"],
                "lowHealth": ["è­¦å‘Šï¼šç”Ÿå‘½å€¼è¿‡ä½ã€‚", "ç³»ç»Ÿæ¿’ä¸´å´©æºƒã€‚", "å»ºè®®ç«‹å³è§„é¿é”™è¯¯ã€‚"],
                "gameOver": ["æ¸¸æˆç»“æŸã€‚è¿æ¥æ–­å¼€ã€‚", "ä»»åŠ¡å¤±è´¥ã€‚", "ç³»ç»Ÿå…³æœºã€‚"],
                "victory": ["ä»»åŠ¡å®Œæˆã€‚ç³»ç»Ÿè¯„ä»·ï¼šSçº§ã€‚", "æ­å–œäººç±»ï¼ŒæŒ‘æˆ˜æˆåŠŸã€‚", "æ‰€æœ‰æ¨¡å—è¿è¡Œæ­£å¸¸ã€‚"]
            ]
        )
        
        // 6. å¦©åªšå§å§ (Charming Sister)
        personas[.charmingSister] = NarratorPersona(
            voice: .wumeinv,
            phrases: [
                "start": ["å“å‘€ï¼Œå°æœ‹å‹ï¼Œå‡†å¤‡å¥½å’Œå§å§ä¸€èµ·å†’é™©äº†å—ï¼Ÿ", "è®©å§å§çœ‹çœ‹ä½ çš„å°æ‰‹çµä¸çµæ´»ï½", "åˆ«ç´§å¼ ï¼Œå§å§ä¼šé™ªç€ä½ çš„ã€‚"],
                "combo_5": ["å—¯ï½ä¸é”™å“¦ã€‚", "å°æ‰‹æŒºå¿«çš„å˜›ã€‚", "ç»§ç»­åŠ æ²¹å“¦ï½"],
                "combo_10": ["å“‡ï¼Œåè¿å‡»äº†å‘¢ã€‚", "å§å§å¼€å§‹å¯¹ä½ åˆ®ç›®ç›¸çœ‹äº†ã€‚", "åŠ¨ä½œå¾ˆæ¼‚äº®å“¦ã€‚"],
                "combo_20": ["äºŒåè¿å‡»ï¼çœŸæ˜¯ä¸ªå‰å®³çš„å°å®¶ä¼™ã€‚", "å§å§çš„å¿ƒéƒ½è¦è¢«ä½ ä¿˜è·äº†ï½", "ä¿æŒè¿™ä¸ªèŠ‚å¥ï¼Œä¸è¦åœã€‚"],
                "combo_30": ["ä¸‰åè¿å‡»ï¼å§å§å¥½å–œæ¬¢ä½ ä¸“æ³¨çš„æ ·å­ã€‚", "å¤ªè¿·äººäº†ï¼Œè¿™æ“ä½œã€‚", "ä½ ç®€ç›´æ˜¯å§å§çš„å°å¶åƒã€‚"],
                "combo_40": ["å››åè¿å‡»ï¼å§å§éƒ½è¦çˆ±ä¸Šä½ äº†ï½", "å¤©å“ªï¼Œä½ æ˜¯æ€ä¹ˆåšåˆ°çš„ï¼Ÿ", "å§å§çš„å¿ƒè·³éƒ½åŠ é€Ÿäº†ã€‚"],
                "combo_50": ["äº”åè¿å‡»ï¼ä½ æ˜¯å§å§è§è¿‡çš„æœ€æ£’çš„å­©å­ï¼", "å¤ªå®Œç¾äº†ï¼Œç®€ç›´æ˜¯è‰ºæœ¯ã€‚", "å§å§è¦ç»™ä½ ä¸€ä¸ªå¤§å¤§çš„æ‹¥æŠ±ï¼"],
                "combo_60": ["å…­åè¿å‡»ï¼å§å§å½»åº•è¢«ä½ å¾æœäº†ã€‚", "ä¸å¯æ€è®®çš„æ‰‹é€Ÿã€‚", "ä½ å°±æ˜¯å§å§å¿ƒä¸­çš„No.1ã€‚"],
                "combo_70": ["ä¸ƒåè¿å‡»ï¼ä½ æ˜¯ç¥ä»™ä¸‹å‡¡å—ï¼Ÿ", "å§å§å·²ç»æ— æ³•ç”¨è¯­è¨€å½¢å®¹ä½ äº†ã€‚", "è¿™ä¸€åˆ»ï¼Œä½ æœ€é—ªè€€ã€‚"],
                "milestone": ["æ­å–œè¿‡å…³ï¼Œæƒ³è¦å§å§ä»€ä¹ˆå¥–åŠ±å‘¢ï¼Ÿ", "è¡¨ç°å¾—çœŸæ£’ï¼Œå§å§å¥½å¼€å¿ƒã€‚"],
                "error": ["å“å‘€ï¼Œä¸è¦æ€¥å˜›ï½", "æ²¡å…³ç³»ï¼Œå§å§ç­‰ä½ ã€‚", "æ·±å‘¼å¸ï¼Œæ…¢æ…¢æ¥ã€‚", "å°å¤±è¯¯è€Œå·²ï¼Œå§å§ä¸æ€ªä½ ã€‚"],
                "lowHealth": ["å°å¿ƒå“¦ï¼Œå§å§ä¼šå¿ƒç–¼çš„ã€‚", "ä¸è¦æ”¾å¼ƒï¼Œå§å§ç›¸ä¿¡ä½ ã€‚", "å¿«æŒ¯ä½œèµ·æ¥ï¼Œä¸ºäº†å§å§ï¼"],
                "gameOver": ["è™½ç„¶è¾“äº†ï¼Œä½†åœ¨å§å§å¿ƒé‡Œä½ è¿˜æ˜¯æœ€æ£’çš„ã€‚", "æ²¡å…³ç³»ï¼Œä¸‹æ¬¡å§å§å†é™ªä½ ç©ã€‚", "ä¼‘æ¯ä¸€ä¸‹å§ï¼Œåˆ«å¤ªç´¯äº†ã€‚"],
                "victory": ["èµ¢å•¦ï¼å§å§å°±çŸ¥é“ä½ è¡Œçš„ï¼", "å¤ªæ£’äº†ï¼Œä½ æ˜¯å§å§çš„éª„å‚²ï¼"]
            ]
        )
        
        // 7. é«˜å†·ç”·ç¥ (Cool God)
        personas[.coolGod] = NarratorPersona(
            voice: .gaolengnanshen,
            phrases: [
                "start": ["å¼€å§‹å§ï¼Œåˆ«è®©æˆ‘å¤±æœ›ã€‚", "è¿™ç§ç¨‹åº¦çš„æŒ‘æˆ˜ï¼Œå¯¹ä½ æ¥è¯´åº”è¯¥å¾ˆå®¹æ˜“å§ã€‚", "æˆ‘ä¸å–œæ¬¢ç­‰äººï¼Œå¿«ç‚¹ã€‚"],
                "combo_5": ["å—¯ã€‚", "è¿˜è¡Œã€‚", "ç»§ç»­ã€‚"],
                "combo_10": ["åè¿å‡»ã€‚å‹‰å¼ºå…¥çœ¼ã€‚", "èŠ‚å¥è¿˜å¯ä»¥ã€‚", "åˆ«å¾—æ„å¿˜å½¢ã€‚"],
                "combo_20": ["äºŒåè¿å‡»ã€‚æœ‰ç‚¹æ„æ€ã€‚", "çœ‹æ¥ä½ ä¸æ˜¯åœ¨æµªè´¹æ—¶é—´ã€‚", "ä¿æŒä¸“æ³¨ã€‚"],
                "combo_30": ["ä¸‰åè¿å‡»ã€‚ä¸é”™çš„ååº”é€Ÿåº¦ã€‚", "ä½ ç¡®å®æœ‰ç‚¹å¤©èµ‹ã€‚", "å¾ˆå¥½ï¼Œåˆ«åœä¸‹ã€‚"],
                "combo_40": ["å››åè¿å‡»ã€‚ä»¤äººæ„‰æ‚¦çš„æ“ä½œã€‚", "çœ‹æ¥æˆ‘æ²¡çœ‹é”™äººã€‚", "ç»§ç»­å±•ç¤ºä½ çš„å®åŠ›ã€‚"],
                "combo_50": ["äº”åè¿å‡»ã€‚å ªç§°å®Œç¾ã€‚", "è¿™æ‰æ˜¯è¯¥æœ‰çš„æ°´å‡†ã€‚", "æˆ‘å¾ˆæ¬£èµä½ çš„ä¸“æ³¨ã€‚"],
                "combo_60": ["å…­åè¿å‡»ã€‚æ— æ‡ˆå¯å‡»ã€‚", "ä½ å·²ç»è¶…è¶Šäº†å¤§å¤šæ•°äººã€‚", "ä»¤äººå°è±¡æ·±åˆ»ã€‚"],
                "combo_70": ["ä¸ƒåè¿å‡»ã€‚ç¥ä¹å…¶æŠ€ã€‚", "ä½ æ˜¯å”¯ä¸€çš„ä¾‹å¤–ã€‚", "å³ä½¿æ˜¯æˆ‘ï¼Œä¹Ÿæ— å¯æŒ‘å‰”ã€‚"],
                "milestone": ["é˜¶æ®µå®Œæˆã€‚è¿™åªæ˜¯å¼€å§‹ã€‚", "å¥–åŠ±ç»™ä½ ï¼Œç»§ç»­å‰è¿›ã€‚"],
                "error": ["å•§ï¼Œå¤§æ„äº†ã€‚", "è¿™ç§å¤±è¯¯ä¸è¯¥å‘ç”Ÿã€‚", "é›†ä¸­ç²¾ç¥ã€‚", "åˆ«è®©æˆ‘çœ‹åˆ°ç¬¬äºŒæ¬¡ã€‚"],
                "lowHealth": ["ä½ åœ¨å¹²ä»€ä¹ˆï¼Ÿæƒ³è¾“å—ï¼Ÿ", "è¿™ç‚¹å›°éš¾å°±è®©ä½ åŠ¨æ‘‡äº†ï¼Ÿ", "ç«™èµ·æ¥ï¼Œåˆ«è®©æˆ‘çœ‹ä¸èµ·ä½ ã€‚"],
                "gameOver": ["ç»“æŸäº†ï¼ŸçœŸæ— è¶£ã€‚", "çœ‹æ¥ä½ ä¹Ÿå°±è¿™ç§ç¨‹åº¦äº†ã€‚", "å›å»å†ç»ƒç»ƒå§ã€‚"],
                "victory": ["èµ¢äº†ã€‚ç†æ‰€å½“ç„¶çš„ç»“æœã€‚", "è¿˜ä¸é”™ï¼Œæ²¡è®©æˆ‘ç™½æ¥ã€‚", "æœŸå¾…ä½ ä¸‹æ¬¡çš„è¡¨ç°ã€‚"]
            ]
        )
        
        // 8. æ»‘ç¨½å¤§å¦ˆ (Funny Aunt)
        personas[.funnyAunt] = NarratorPersona(
            voice: .huajidama,
            phrases: [
                "start": ["å“å“Ÿå–‚ï¼Œå°ä¹–ä¹–ï¼Œå¿«æ¥è®©å¤§å¦ˆçœ‹çœ‹ä½ çš„æœ¬äº‹ï¼", "è¿™å°±å¼€å§‹å•¦ï¼Ÿå¤§å¦ˆæˆ‘ç“œå­éƒ½å‡†å¤‡å¥½äº†ï¼", "åˆ«æ€•åˆ«æ€•ï¼Œå¤§å¦ˆç»™ä½ åŠ æ²¹ï¼"],
                "combo_5": ["å“å“Ÿä¸é”™å“¦ï¼", "è¿™å°æ‰‹ï¼ŒçœŸçµå·§ï¼", "å˜¿å˜¿ï¼Œæœ‰ç‚¹æ„æ€ï¼"],
                "combo_10": ["åè¿å‡»ï¼æ¯”å¤§å¦ˆæˆ‘è·³å¹¿åœºèˆè¿˜å¸¦åŠ²ï¼", "å“å‘€å¦ˆå‘€ï¼Œå¤ªå‰å®³äº†ï¼", "è¿™å­©å­ï¼ŒçœŸæœ‰å‡ºæ¯ï¼"],
                "combo_20": ["äºŒåè¿å‡»ï¼çœ‹å¾—å¤§å¦ˆæˆ‘çœ¼éƒ½èŠ±äº†ï¼", "ä½ æ˜¯åƒä»€ä¹ˆé•¿å¤§çš„ï¼Œè¿™ä¹ˆå‰å®³ï¼Ÿ", "å¤§å¦ˆè¦ç»™ä½ å‘ä¸ªå¤§çº¢åŒ…ï¼"],
                "combo_30": ["ä¸‰åè¿å‡»ï¼ç®€ç›´æ˜¯éš”å£è€ç‹å®¶çš„éª„å‚²ï¼", "å¤ªç¥äº†ï¼Œå¤§å¦ˆéƒ½è¦æ‹œä½ ä¸ºå¸ˆäº†ï¼", "è¿™æ“ä½œï¼Œæ¯”æ‰“éº»å°†è¿˜æºœï¼"],
                "combo_40": ["å››åè¿å‡»ï¼å“å“Ÿæˆ‘çš„å¿ƒè„å—ä¸äº†äº†ï¼", "æ…¢ç‚¹æ…¢ç‚¹ï¼Œå¤§å¦ˆè·Ÿä¸ä¸Šäº†ï¼", "ä½ å°±æ˜¯è¿™æ¡è¡—æœ€é“çš„ä»”ï¼"],
                "combo_50": ["äº”åè¿å‡»ï¼å¤§å¦ˆæˆ‘è¦å»æ‘å£å¹¿æ’­ä½ çš„äº‹è¿¹ï¼", "å¤ªç‰›äº†ï¼Œå¤§å¦ˆç»™ä½ ç‚¹ä¸€ä¸‡ä¸ªèµï¼", "è¿™æ‰‹é€Ÿï¼Œèƒ½æŠ¢å¤šå°‘çº¢åŒ…å•Šï¼"],
                "combo_60": ["å…­åè¿å‡»ï¼ä½ æ˜¯ç¥ä»™ä¸‹å‡¡å§ï¼Ÿ", "å¤§å¦ˆæˆ‘è¿™è¾ˆå­æ²¡è§è¿‡è¿™ä¹ˆå‰å®³çš„ï¼", "å…¨æ‘çš„å¸Œæœ›éƒ½åœ¨ä½ èº«ä¸Šäº†ï¼"],
                "combo_70": ["ä¸ƒåè¿å‡»ï¼å¤§å¦ˆç»™ä½ è·ªäº†ï¼", "ä½ æ˜¯ç”µï¼Œä½ æ˜¯å…‰ï¼Œä½ æ˜¯å”¯ä¸€çš„ä¼ è¯´ï¼", "å¤§å¦ˆè¦è®¤ä½ åšå¹²å„¿å­/å¹²å¥³å„¿ï¼"],
                "milestone": ["è¿‡å…³å•¦ï¼å¤§å¦ˆç»™ä½ è·³ä¸ªèˆåº†ç¥ä¸€ä¸‹ï¼", "çœŸæ£’çœŸæ£’ï¼Œå¥–åŠ±æ‹¿å»ä¹°ç³–åƒï¼"],
                "error": ["å“å‘€ï¼Œæ‰‹æ»‘äº†æ‰‹æ»‘äº†ï¼", "æ²¡äº‹æ²¡äº‹ï¼Œå¤§å¦ˆæˆ‘ä¸ç¬‘è¯ä½ ï¼", "åˆ«æ€¥å˜›ï¼Œå¿ƒæ€¥åƒä¸äº†çƒ­è±†è…ï¼", "å“å“Ÿå–‚ï¼Œå·®ç‚¹å°±å¯¹äº†ï¼"],
                "lowHealth": ["å“å‘€å°å¿ƒå•Šï¼Œè¡€éƒ½è¦æ²¡äº†ï¼", "æŒºä½æŒºä½ï¼Œå¤§å¦ˆç»™ä½ å¥¶ä¸€å£ï¼", "åˆ«æ­»å•Šï¼Œå¤§å¦ˆè¿˜æƒ³å¤šçœ‹ä¸¤çœ¼å‘¢ï¼"],
                "gameOver": ["å“å‘€è¾“äº†ï¼Œæ²¡äº‹ï¼Œå¤§å¦ˆè¯·ä½ åƒé¥ºå­ï¼", "èƒœè´¥ä¹ƒå…µå®¶å¸¸äº‹ï¼Œä¸‹æ¬¡å†æ¥ï¼", "æ­‡ä¼šå„¿æ­‡ä¼šå„¿ï¼Œåˆ«ç´¯åäº†èº«ä½“ï¼"],
                "victory": ["èµ¢å•¦èµ¢å•¦ï¼ä»Šæ™šåŠ é¸¡è…¿ï¼", "å¤ªå‰å®³äº†ï¼Œå¤§å¦ˆä¸ºä½ æ„Ÿåˆ°éª„å‚²ï¼", "è¿™å­©å­ï¼Œå°†æ¥å¿…æˆå¤§å™¨ï¼"]
            ]
        )
        
        // 9. å°‘å¥³å¯è‰ (Klee)
        personas[.klee] = NarratorPersona(
            voice: .dudulibao,
            phrases: [
                "start": ["å“’å“’å“’ï½å¯è‰æ¥å•¦ï¼ä¸€èµ·å»å¤§å†’é™©å§ï¼", "å¥½è€¶ï¼å¯ä»¥ç©æ¸¸æˆäº†å—ï¼Ÿ", "å¯è‰ä¼šä¿æŠ¤ä½ çš„ï¼Œè™½ç„¶æˆ‘ä¹Ÿå¯èƒ½ä¼šé—¯ç¥¸..."],
                "combo_5": ["å¥½è€¶ï¼", "è¹¦è¹¦ç‚¸å¼¹ï¼", "ç»§ç»­ç»§ç»­ï¼"],
                "combo_10": ["åè¿å‡»ï¼åƒçƒŸèŠ±ä¸€æ ·æ¼‚äº®ï¼", "å“‡ï¼Œä½ å¥½å‰å®³å‘€ï¼", "å¯è‰å¥½å¼€å¿ƒï¼"],
                "combo_20": ["äºŒåè¿å‡»ï¼æ¯”å˜Ÿå˜Ÿå¯è¿˜å‰å®³ï¼", "è½°è½°ç«èŠ±ï¼", "å…¨éƒ½è¦ç‚¸é£ï¼"],
                "combo_30": ["ä¸‰åè¿å‡»ï¼å°±åƒç‚¸å¼¹çˆ†ç‚¸ä¸€æ ·çˆ½å¿«ï¼", "å¯è‰è¦ç»™ä½ çœ‹ä¸ªå¤§å®è´ï¼", "å¤ªå¥½ç©å•¦ï¼"],
                "combo_40": ["å››åè¿å‡»ï¼ç´å›¢é•¿çœ‹åˆ°äº†ä¹Ÿä¼šå¤¸ä½ çš„ï¼", "ä½ æ˜¯å¯è‰æœ€å¥½çš„æœ‹å‹ï¼", "ç«åŠ›å…¨å¼€ï¼"],
                "combo_50": ["äº”åè¿å‡»ï¼å¯è‰è¦æŠŠè¿™ä¸ªå†™è¿›ç”Ÿå­˜å®ˆåˆ™ï¼", "ä½ æ˜¯æœ€æ£’çš„éª‘å£«ï¼", "æ‰€æœ‰åäººéƒ½è¢«ç‚¸è·‘å•¦ï¼"],
                "combo_60": ["å…­åè¿å‡»ï¼å“‡â€”â€”ï¼å¤ªå¼ºå•¦ï¼", "å¯è‰è¦æŠŠæœ€å¥½åƒçš„é±¼ç»™ä½ ï¼", "æˆ‘ä»¬è¦æŠŠè¿™é‡Œç‚¸å¹³å—ï¼Ÿ"],
                "combo_70": ["ä¸ƒåè¿å‡»ï¼ä½ æ˜¯å¤§é­”ç‹å—ï¼Ÿ", "å¯è‰ä½©æœå¾—äº”ä½“æŠ•åœ°ï¼", "å…¨ä¸–ç•Œæœ€å‰å®³çš„å†’é™©å®¶ï¼"],
                "milestone": ["è¿‡å…³å•¦ï¼æˆ‘ä»¬å»ç‚¸é±¼åº†ç¥å§ï¼", "è¿™æ˜¯å¯è‰é€ä½ çš„å®è—å“¦ï¼"],
                "error": ["å“å‘€ï¼Œç‚¸æ­ªäº†ï¼", "æ²¡å…³ç³»ï¼Œå†æ¥ä¸€æ¬¡ï¼", "å‘œå‘œï¼Œä¸è¦ç°å¿ƒ...", "å¯è‰ä¹Ÿç»å¸¸çŠ¯é”™å‘¢..."],
                "lowHealth": ["ä¸å¥½å•¦ï¼Œè¦è¢«å…³ç¦é—­äº†ï¼", "å¿«è·‘å¿«è·‘ï¼", "åšæŒä½ï¼Œå¯è‰ä¸æƒ³ä¸€ä¸ªäººå›å»..."],
                "gameOver": ["å‘œå‘œå‘œï¼Œè¾“æ‰äº†...", "ç´å›¢é•¿è¦æ¥äº†ï¼Œå¿«è·‘ï¼", "è™½ç„¶è¾“äº†ï¼Œä½†è¿˜æ˜¯å¾ˆå¼€å¿ƒï¼"],
                "victory": ["å…¨èƒœï¼æˆ‘ä»¬å¯ä»¥å»ç‚¸é±¼å•¦ï¼", "å¥½è€¶ï¼å¤§å†’é™©æˆåŠŸï¼", "ä½ æ˜¯è’™å¾·åŸçš„è‹±é›„ï¼"]
            ]
        )
        
        // 10. åŠ¨æ¼«å°‘å¥³ (Anime Girl)
        personas[.animeGirl] = NarratorPersona(
            voice: .dongmanshaonv,
            phrases: [
                "start": ["æ¬§å°¼é…±/æ¬§å†…é…±ï¼Œæ¸¸æˆå¼€å§‹äº†å“¦ï½", "ä¸ºäº†æ­£ä¹‰ä¸çˆ±ï¼Œå‡ºå‡»ï¼", "é­”æ³•å°‘å¥³å˜èº«ï¼"],
                "combo_5": ["å¹²å·´çˆ¹ï¼", "å°±æ˜¯è¿™æ ·ï¼", "å¥½å‰å®³ï¼"],
                "combo_10": ["åè¿å‡»ï¼è¿™å°±æ˜¯ç¾ç»Šçš„åŠ›é‡å—ï¼Ÿ", "æ–¯å›½ä¸€ï¼", "ä¸æ„§æ˜¯ä½ å‘¢ï¼"],
                "combo_20": ["äºŒåè¿å‡»ï¼ç‡ƒçƒ§å§ï¼Œå°å®‡å®™ï¼", "è¿™å°±æ˜¯çƒ­è¡€çš„æ„Ÿè§‰å—ï¼Ÿ", "å“ªæ€•æ˜¯ç¥ï¼Œä¹Ÿè¦è¶…è¶Šç»™ä½ çœ‹ï¼"],
                "combo_30": ["ä¸‰åè¿å‡»ï¼æˆ‘ä»¬çš„å¿ƒæ„ç›¸é€šäº†ï¼", "å¤ªå¸…äº†ï¼Œæˆ‘è¦ä¸ºä½ å†™é¦–æ­Œï¼", "è¿™ç§åŠ›é‡...æ˜¯å¥‡è¿¹å—ï¼Ÿ"],
                "combo_40": ["å››åè¿å‡»ï¼æ¬¡å…ƒå£éƒ½è¦è¢«ä½ æ‰“ç ´äº†ï¼", "è§‰é†’å§ï¼Œæ²‰ç¡çš„åŠ›é‡ï¼", "ç°åœ¨çš„ä½ ï¼Œé—ªé—ªå‘å…‰å“¦ï¼"],
                "combo_50": ["äº”åè¿å‡»ï¼è¿™å°±æ˜¯ä¼ è¯´ä¸­çš„ä¸»è§’å…‰ç¯ï¼", "æˆ‘è¦æ°¸è¿œè¿½éšä½ ï¼", "æ²¡æœ‰ä»»ä½•ä¸œè¥¿èƒ½é˜»æŒ¡ä½ äº†ï¼"],
                "combo_60": ["å…­åè¿å‡»ï¼ç®€ç›´æ˜¯ç¥è¿¹ï¼", "æˆ‘çš„çœ¼ä¸­åªæœ‰ä½ ï¼", "ä¸–ç•Œéƒ½è¦ä¸ºä½ æ¬¢å‘¼ï¼"],
                "combo_70": ["ä¸ƒåè¿å‡»ï¼ä½ å·²ç»æ˜¯äºŒæ¬¡å…ƒçš„ç¥äº†ï¼", "è¿™æ‰æ˜¯çœŸæ­£çš„æœ€å¼ºï¼", "æˆ‘å·²ç»è¿·ä¸Šä½ äº†ï¼"],
                "milestone": ["è¿‡å…³è¾¾æˆï¼è¿™æ˜¯çˆ±çš„å¥–åŠ±å“¦ï½", "è¿™æ˜¯æˆ‘ä»¬å…±åŒåŠªåŠ›çš„æˆæœï¼"],
                "error": ["å‘€ï¼Œä¸è¦åœ¨æ„ç»†èŠ‚ï¼", "æ²¡å…³ç³»çš„ï¼Œæˆ‘ç›¸ä¿¡ä½ ï¼", "è¿™åªæ˜¯ä¸ºäº†å‰§æƒ…åè½¬åšçš„é“ºå«ï¼", "æŒ¯ä½œä¸€ç‚¹ï¼Œè¿˜æ²¡ç»“æŸå‘¢ï¼"],
                "lowHealth": ["é›…è ›è¶ï¼ä¸èƒ½è¾“å•Šï¼", "ä¸€å®šè¦åšæŒä½ï¼Œä¸ºäº†æˆ‘ä»¬çš„çº¦å®šï¼", "æŠŠåŠ›é‡å€Ÿç»™ä½ ï¼"],
                "gameOver": ["è™½ç„¶è¾“äº†ï¼Œä½†æˆ‘ä»¬çš„ç¾ç»Šä¸ä¼šæ–­ï¼", "ä¸‹æ¬¡ä¸€å®šèƒ½èµ¢å›æ¥çš„ï¼", "ä¸è¦å“­ï¼Œçœ¼æ³ªä¸é€‚åˆä½ ï¼"],
                "victory": ["èƒœåˆ©æ˜¯å±äºæˆ‘ä»¬çš„ï¼", "å¤ªå¥½äº†ï¼Œä¸–ç•Œå’Œå¹³äº†ï¼", "æˆ‘å°±çŸ¥é“ä½ ä¸€å®šèƒ½åšåˆ°ï¼"]
            ]
        )
    }
    
    private func updateVoice() {
        guard let persona = personas[currentType] else { return }
        self.tts.currentVoice = persona.voice.rawValue
    }
    
    /// è§¦å‘æ—ç™½
    func trigger(_ event: NarratorEvent, completion: (() -> Void)? = nil) {
        guard isEnabled else {
            completion?()
            return
        }
        
        // æ£€æŸ¥å†·å´æ—¶é—´ï¼ˆé™¤äº†æ¸¸æˆå¼€å§‹ã€ç»“æŸã€é‡Œç¨‹ç¢‘ã€ä½è¡€é‡ç­‰é‡è¦äº‹ä»¶å¤–ï¼‰
        let now = Date()
        if case .combo = event {
            if now.timeIntervalSince(lastSpeakTime) < minInterval {
                completion?()
                return
            }
        }
        
        // è·å–å½“å‰è§’è‰²çš„å°è¯
        guard let persona = personas[currentType] else {
            completion?()
            return
        }
        
        var key = ""
        switch event {
        case .gameStart: key = "start"
        case .combo(let count): key = "combo_\(count)"
        case .milestone: key = "milestone"
        case .error: key = "error"
        case .lowHealth: key = "lowHealth"
        case .gameOver: key = "gameOver"
        case .victory: key = "victory"
        }
        
        if let phrases = persona.phrases[key], !phrases.isEmpty {
            let phrase = phrases.randomElement() ?? ""
            print("ğŸ—£ï¸ [Narrator] \(currentType.rawValue): \(phrase)")
            
            // æ›´æ–°æœ€åè¯´è¯æ—¶é—´
            lastSpeakTime = now
            
            // æ’­æ”¾ TTS
            tts.speak(text: phrase) { _ in
                completion?()
            }
        } else {
            completion?()
        }
    }
    
    func previewCurrentVoice() {
        // Ignore isEnabled and cooldown for preview
        guard let persona = personas[currentType],
              let list = persona.phrases["start"], // Use 'start' phrases for preview
              !list.isEmpty else { return }
        
        let text = list.randomElement()!
        print("ğŸ—£ï¸ [NARRATOR] Preview (\(currentType.rawValue)): \(text)")
        tts.speak(text: text)
    }

    func stopSpeaking() {
        tts.stop()
    }
}
